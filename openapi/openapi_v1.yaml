openapi: 3.1.0
jsonSchemaDialect: https://spec.openapis.org/oas/3.1/dialect/base
info:
  title: Enhancely API
  version: "1.0.0"
  x-logo:
    url: enhancely-logo.png
    altText: Enhancely Logo
    backgroundColor: "#FFFFFF"
    href: https://enhancely.ai
  description: |
    ## Overview

    The Enhancely API provides automatic generation and retrieval of Schema.org JSON-LD structured data for your web pages. This structured data helps search engines, AI platforms, and AI search tools better understand and represent your content.

    ## Prerequisites

    This API is exclusively available to Enhancely customers who have:
    1. Added their domain to the Enhancely platform
    2. Validated domain ownership
    3. Retrieved their domain-specific API key

    ## Integration Approaches

    ### POST vs GET: Which Endpoint to Use

    **Use POST /api/v1/jsonld for CMS & Website Integration:**
    - Primary endpoint for page-level integration
    - Automatically creates records if they don't exist
    - Supports sending complex URLs in request body (no query string length limits)
    - Returns `412 Precondition Failed` when ETag matches (cache valid)
    - Ideal for server-side rendering in templates

    **Use GET /api/v1/jsonld/{hash} for:**
    - Polling processing status after receiving 201/202 from POST
    - Direct retrieval when you already have the MD5 hash
    - Returns `304 Not Modified` when ETag matches (cache valid)

    **Use GET /api/v1/jsonld for:**
    - Listing all JSON-LD records for your domain
    - Monitoring and troubleshooting with filters

    ### CMS Plugins & Website Integration (Recommended)

    For integrating Enhancely into your website or CMS, follow this pattern:

    1. **Template Integration**: Add the API call in your page template's `<head>` section
    2. **URL Normalization**: Strip query parameters, hashes, and trailing slashes before caching
    3. **Cache-First Strategy**: Check local cache before making API requests (recommended TTL: 1 week)
    4. **ETag Validation**: Always send `If-None-Match` header with cached ETag
    5. **Silent Degradation**: Return empty output on errors to avoid breaking page rendering
    6. **Cache Invalidation**: Clear cache when page content is updated

    ### Bulk Operations

    **Sitemap Indexation**: Automatic crawling of all URLs in your sitemap.xml is available through the Enhancely platform (not via API). This feature requires appropriate access rights and is ideal for initial setup or when adding many pages at once.

    **Nightly Updates**: Enhancely automatically checks all indexed URLs nightly to detect content changes and regenerate JSON-LD when needed, keeping your structured data fresh without manual intervention.

    ## Cache Strategy

    Enhancely implements a sophisticated multi-layer caching system:

    ### HTTP-Level Caching (ETags)

    Every JSON-LD response includes an `ETag` header—a unique identifier for that version of the content. Use ETags for efficient caching:

    ```http
    # First request
    POST /api/v1/jsonld
    Authorization: Bearer YOUR_API_KEY
    Content-Type: application/json
    Accept: application/json

    {"url": "https://example.com/page"}

    HTTP/1.1 200 OK
    ETag: "a1b2c3d4e5f6"
    Content-Type: application/json

    {
      "hash": "7c165c13f93d7ca168bcfbd73cf563e3",
      "url": "https://example.com/page",
      "jsonld": {...},
      "metadata": {},
      "etag": "a1b2c3d4e5f6",
      "crawled_at": "2025-01-16T14:30:00Z",
      "status": "ready"
    }
    ```

    ```http
    # Subsequent request with cached ETag
    POST /api/v1/jsonld
    Authorization: Bearer YOUR_API_KEY
    Content-Type: application/json
    Accept: application/json
    If-None-Match: "a1b2c3d4e5f6"

    {"url": "https://example.com/page"}

    HTTP/1.1 412 Precondition Failed
    ```

    **Benefits:**
    - `412 Precondition Failed` responses have no body, saving bandwidth
    - Avoids redundant processing when content hasn't changed
    - Standard HTTP caching mechanism supported by all HTTP clients
    - Learn more: [MDN: HTTP Conditional Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests)

    ### Content Change Detection

    Internally, Enhancely tracks HTML content changes by hashing the page content. When a URL is re-crawled:

    1. The page HTML is fetched and hashed
    2. If the hash matches the previous crawl, JSON-LD generation is skipped
    3. Only the `crawledAt` timestamp is updated
    4. The existing ETag remains valid

    This means:
    - ETags only change when actual content changes occur
    - Minor HTML changes (like navigation updates) don't trigger regeneration if the core content is unchanged
    - Your cached JSON-LD remains valid longer, reducing API calls

    ### Implementation Best Practices

    **Cache Key Generation:**
    - Use MD5 hash of the normalized URL as the cache key
    - Normalize URLs consistently: remove query params, hashes, and trailing slashes
    - Store both ETag and JSON-LD data separately

    **Cache Duration:**
    - **Recommended TTL**: 1 week (604,800 seconds)
    - Longer TTLs reduce API load since Enhancely automatically updates content nightly
    - ETags remain valid across nightly updates if content hasn't changed

    **Cache Invalidation:**
    - Clear cache when page content is updated (e.g., via CMS hooks)
    - Optional: Clear cache in local/development environments for testing
    - Prevent page-level caching when API errors occur

    **Recommended Flow:**
    1. Check local cache for ETag and JSON-LD data
    2. Make POST request with `If-None-Match` header containing cached ETag
    3. Handle 412 response by returning cached data (ETag still valid)
    4. Handle 200 response by caching new ETag and JSON-LD with 1-week TTL
    5. Handle errors by returning cached data or empty output (silent degradation)

    ## Processing Model

    JSON-LD generation is **asynchronous**. When you submit a URL:

    1. **201 Created**: The URL is queued for processing (first time submission)
    2. **202 Accepted**: The URL exists but is currently being processed
    3. **200 OK**: The JSON-LD already exists and is available (with current status)

    Processing can take up to a few minutes depending on page complexity and queue depth. The response includes a `status` field:

    - `created`: Queued for processing, JSON-LD generation hasn't started yet (typically returns 201 on first POST)
    - `updating`: Currently being processed (returns 202 when still processing)
    - `ready`: JSON-LD is available and ready to use (returns 200 with full content)
    - `failed`: Generation failed (e.g., invalid page, unreachable URL)

    For newly created records or records being processed (201/202 responses), poll the **GET /api/v1/jsonld/{hash}** endpoint to check when processing completes and the status becomes `ready`.

    ## Rate Limiting

    All endpoints are rate-limited per domain. Each response includes rate limit headers to help you track your usage.

    ### Rate Limit Headers

    ```http
    RateLimit-Limit: 100        # Maximum requests allowed in the current window
    RateLimit-Remaining: 75     # Requests remaining in the current window
    RateLimit-Reset: 1640000000 # Unix timestamp when the limit resets
    ```

    ### Handling Rate Limits

    **429 Too Many Requests Response:**
    ```json
    {
      "type": "https://enhancely.ai/problems/rate-limit-exceeded",
      "title": "Rate Limit Exceeded",
      "status": 429,
      "detail": "You have exceeded your rate limit. Please try again later."
    }
    ```

    ### Best Practices for Rate Limit Management

    **1. Implement Aggressive Caching**

    The most effective rate limit strategy is to **avoid making API calls** through proper caching:

    - Cache responses with a 1-week TTL minimum
    - Always send `If-None-Match` headers with cached ETags
    - 412 responses use minimal bandwidth and help avoid rate limits
    - Only make new requests when cache is cold or content changes

    **2. Monitor Rate Limit Headers**

    Check `RateLimit-Remaining` and `RateLimit-Reset` headers to track usage and implement proactive backoff when limits are approaching.

    **3. Implement Retry Logic**

    For 429 responses, wait until the `RateLimit-Reset` timestamp before retrying. For 5xx server errors, use exponential backoff (e.g., 1s, 2s, 4s).

    **4. Use Silent Degradation**

    When rate limited or encountering errors, return cached data or empty output rather than breaking page rendering.

    ## Error Handling

    Proper error handling ensures your integration degrades gracefully when issues occur. The API uses standard HTTP status codes and RFC 7807 Problem Details format.

    ### HTTP Status Codes

    | Status | Meaning | Action |
    |--------|---------|--------|
    | **200 OK** | JSON-LD ready and returned | Cache and render |
    | **201 Created** | URL queued for first-time processing | Wait/poll, return empty or cached |
    | **202 Accepted** | Processing in progress | Wait/poll, return empty or cached |
    | **304 Not Modified** | GET with ETag - content unchanged | Use cached data |
    | **400 Bad Request** | Invalid URL or malformed request | Log error, return empty |
    | **401 Unauthorized** | Missing/invalid API key | Check API key configuration |
    | **404 Not Found** | Resource doesn't exist | Log error, return empty |
    | **412 Precondition Failed** | POST with ETag - content unchanged | Use cached data |
    | **415 Unsupported Media Type** | Wrong Content-Type header | Set `Content-Type: application/json` |
    | **429 Too Many Requests** | Rate limit exceeded | Wait for `RateLimit-Reset`, use cached data |
    | **500 Server Error** | Internal server error | Retry with backoff, use cached data |
    | **502 Bad Gateway** | Upstream service error | Retry with backoff, use cached data |
    | **503 Service Unavailable** | Service temporarily down | Retry with backoff, use cached data |

    ### Error Response Format

    All error responses follow RFC 7807 Problem Details format:

    ```json
    {
      "type": "https://enhancely.ai/problems/rate-limit-exceeded",
      "title": "Rate Limit Exceeded",
      "status": 429,
      "detail": "You have exceeded your rate limit. Please try again later.",
      "instance": "/api/v1/jsonld"
    }
    ```

    ### Best Practices

    **Silent Degradation (Recommended)**
    - Return cached data or empty output when errors occur
    - Never break page rendering due to API errors
    - Log errors in debug/development mode with HTML comments
    - Use monitoring systems in production (Sentry, New Relic, etc.)

    **Response Handling:**
    - ✅ Cache only successful 200 responses with ETag
    - ✅ Return cached data for 412 (ETag matches)
    - ✅ Return empty or cached data for 201/202 (processing) - first-time requests return empty until ready
    - ✅ Return cached data on 5xx errors, retry with exponential backoff
    - ✅ Log and return empty on 400/401/404 - don't retry client errors
    - ✅ Wait for `RateLimit-Reset` on 429, return cached data

    **Cache Management:**
    - Prevent page-level caching when API errors occur (use cache-control headers or framework-specific mechanisms)
    - Clear local cache only when page content is updated
    - Skip API calls entirely on error pages (404, 500)

servers:
  - url: https://enhancely.ai
    description: API V1
tags:
  - name: JSON-LD Endpoints
    description: |
      Endpoints for generating and retrieving Schema.org JSON-LD structured data from web page URLs.

      These endpoints enable automatic creation of rich structured data that helps search engines, AI platforms, and AI search tools better understand and represent your content.
x-tagGroups:
  - name: Enhancely API
    tags:
      - JSON-LD Endpoints

paths:
  /api/v1/jsonld:
    get:
      tags: [ JSON-LD Endpoints ]
      summary: List all JSON-LD records for your domain
      description: |
        Retrieves a list of all JSON-LD records associated with your domain, providing an overview of indexed URLs and their processing status.

        **Primary use cases:** Monitoring, troubleshooting, and auditing. For website integration, use the POST endpoint instead.

        **Filtering:** Supports filtering by `status`, `hash`, `etag`, `url`, and timestamps (`created_at`, `updated_at`, `crawled_at`).
      operationId: getJsonLdList
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: etag
          required: false
          description: |
            Filter by ETag value. Use `*` to match any record with an ETag, or provide a specific ETag value.
          schema:
            type: string
          example: "a1b2c3d4e5f6"
        - in: query
          name: hash
          required: false
          description: |
            Filter by MD5 hash of the URL. See GET /api/v1/jsonld/{hash} endpoint for hash calculation details.
          schema:
            type: string
            pattern: '^[a-f0-9]{32}$'
          example: "7c165c13f93d7ca168bcfbd73cf563e3"
        - in: query
          name: url
          required: false
          description: |
            Filter by the source URL.
          schema:
            type: string
            format: uri
          example: "https://example.com/page"
        - in: query
          name: id
          required: false
          description: |
            Filter by JSON-LD @id field.
          schema:
            type: string
        - in: query
          name: status
          required: false
          description: |
            Filter by processing status.
          schema:
            $ref: '#/components/schemas/JsonLdStatus'
          example: "ready"
        - in: query
          name: created_at
          required: false
          description: |
            Filter records created after this timestamp (greater than comparison).
          schema:
            type: string
            format: date-time
          example: "2025-01-01T00:00:00Z"
        - in: query
          name: updated_at
          required: false
          description: |
            Filter records updated after this timestamp (greater than comparison).
          schema:
            type: string
            format: date-time
          example: "2025-01-01T00:00:00Z"
        - in: query
          name: crawled_at
          required: false
          description: |
            Filter records crawled after this timestamp (greater than comparison).
          schema:
            type: string
            format: date-time
          example: "2025-01-01T00:00:00Z"
      responses:
        '200':
          $ref: '#/components/responses/OkJsonLdList'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      tags: [ JSON-LD Endpoints ]
      summary: Generate or retrieve JSON-LD for a URL (Primary Integration Endpoint)
      description: |
        **This is the recommended endpoint for CMS plugins and website integrations.**

        Submits a URL for JSON-LD generation or retrieves existing JSON-LD if already processed. This endpoint is designed for optimal performance with HTTP caching using ETags.

        ## How It Works

        JSON-LD generation is **asynchronous**. See the **Processing Model** section in the API overview for complete details on status values and lifecycle.

        **Response Codes:**
        - **201 Created**: New URL queued for first-time processing
        - **202 Accepted**: URL is being processed (processing in progress)
        - **200 OK**: URL already exists (check `status` field for current state)
        - **412 Precondition Failed**: ETag provided matches current version (cache still valid)

        **Status Values:** `created` → `updating` → `ready` or `failed`

        ### Subsequent Requests (With Cache)

        On subsequent requests, include the `If-None-Match` header with your cached ETag:

        ```http
        POST /api/v1/jsonld
        Authorization: Bearer YOUR_API_KEY
        Content-Type: application/json
        If-None-Match: "a1b2c3d4e5f6"

        {"url": "https://example.com/page"}
        ```

        **Response:**
        - **412 Precondition Failed**: ETag matches current version (cache still valid, no body returned)
        - **200 OK**: Content has changed or no etag match, fresh JSON-LD returned with new ETag

        ## HTTP Caching with ETags

        This endpoint supports standard HTTP conditional requests using ETags for efficient caching. For complete details, see the **Cache Strategy** section in the API overview above.

        **Quick Reference:**
        - Include `If-None-Match: "etag-value"` header to check for changes
        - Response `412 Precondition Failed` = etag matches, use your cached version (no body)
        - Response `200 OK` = new content available with updated ETag

        ## Best Practices for Integration

        1. **Always cache both ETag and JSON-LD** after receiving a 200/201 response
        2. **Always send If-None-Match** with the cached ETag on subsequent requests
        3. **Handle 412 responses** by using your cached JSON-LD (no new data in body)
        4. **Handle 201/202 responses** for new URLs by polling until status is `ready`
        5. **Respect rate limits** shown in `RateLimit-*` headers

        After a successful crawl, Enhancely automatically re-checks URLs nightly to detect content changes. If changes are detected, the JSON-LD is regenerated and a new ETag is issued.


      operationId: postJsonLd
      security:
        - BearerAuth: [ ]
      parameters:
        - in: header
          name: If-None-Match
          required: false
          description: |
            Optional. The ETag value from a previous response. If provided and matches the current ETag, returns `412 Precondition Failed`.
          schema:
            type: string
          example: "a1b2c3d4e5f6"
        - in: header
          name: Accept
          required: false
          description: |
            Optional. Specify `application/ld+json` to receive only the JSON-LD content without wrapper metadata. Defaults to `application/json` which includes metadata fields (status, etag, hash, etc.).
          schema:
            type: string
            enum:
              - application/json
              - application/ld+json
          example: "application/json"
      requestBody:
        $ref: '#/components/requestBodies/JsonLdRequestBody'
      responses:
        '201':
          $ref: '#/components/responses/CreatedJsonLd'
        '202':
          $ref: '#/components/responses/AcceptedJsonLd'
        '200':
          $ref: '#/components/responses/OkJsonLd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '412':
          $ref: '#/components/responses/PreconditionFailed'
        '415':
          $ref: '#/components/responses/UnsupportedMediaType415'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/v1/jsonld/{hash}:
    get:
      tags: [ JSON-LD Endpoints ]
      summary: Retrieve a specific JSON-LD document by URL hash
      description: |
        Retrieves a JSON-LD document for a specific URL using its MD5 hash as the identifier. This endpoint is useful for polling processing status or retrieving JSON-LD when you already know the hash.

        ## URL Hash

        The `hash` parameter is the MD5 hash of the **absolute URL** (lowercase hexadecimal):

        ```javascript
        import crypto from 'crypto';

        const url = 'https://example.com/page';
        const hash = crypto.createHash('md5').update(url).digest('hex');
        // Result: "7c165c13f93d7ca168bcfbd73cf563e3"
        ```

        **Use cases:** Status polling after receiving 201 Created, or direct retrieval when you have the hash.

        ## HTTP Caching Support

        Supports ETag-based conditional requests. Send the `If-None-Match` header with your cached ETag to receive `304 Not Modified` when content hasn't changed. See **Cache Strategy** section for full implementation details.

        ## Response Format

        The response includes the JSON-LD document along with metadata:

        ```json
        {
          "@context": "https://schema.org",
          "@type": "Article",
          "headline": "Example Article",
          "status": "ready",
          "etag": "a1b2c3d4e5f6",
          ...
        }
        ```

        ## Processing Status

        The response includes a `status` field indicating the current processing state. See **Processing Model** section in the API overview for status definitions.

        ## When to Use GET vs POST

        **Use POST /api/v1/jsonld (Recommended for Integration):**
        - ✅ CMS plugins and website integrations
        - ✅ When you have the page URL (not the hash)
        - ✅ When you want automatic creation if URL doesn't exist
        - ✅ For ETag-based caching with `If-None-Match` header (returns 412)
        - ✅ When sending complex URLs that may exceed query string limits
        - ✅ First-time requests that need async processing (201/202 status)

        **Use GET /api/v1/jsonld/{hash}:**
        - ✅ When you already have the MD5 hash of the URL
        - ✅ Polling for processing status after receiving 201/202 from POST
        - ✅ Direct retrieval when hash is known
        - ✅ For ETag-based caching with `If-None-Match` header (returns 304)
        - ✅ Monitoring and administrative tasks

        **Use GET /api/v1/jsonld (list endpoint):**
        - ✅ Auditing all JSON-LD records for your domain
        - ✅ Bulk status checking with filters
        - ✅ Monitoring and troubleshooting
        - ✅ Building internal dashboards

        **Key Differences:**
        - POST creates new records (201) if they don't exist; GET returns 404
        - POST with `If-None-Match` returns 412; GET with `If-None-Match` returns 304
        - POST sends URL in request body; GET sends hash in URL path
        - Both support ETag-based conditional requests for efficient caching

      operationId: getJsonLdById
      security:
        - BearerAuth: [ ]
      parameters:
        - in: path
          name: hash
          required: true
          description: |
            MD5 of the absolute URL (32 lowercase hexadecimal characters).
            Example: `7c165c13f93d7ca168bcfbd73cf563e3`.
          schema:
            type: string
            pattern: '^[a-f0-9]{32}$'
        - in: header
          name: If-None-Match
          required: false
          description: |
            Optional. Return `304 Not Modified` if the supplied ETag matches the current resource ETag.
          schema:
            type: string
          example: "a1b2c3d4e5f6"
        - in: header
          name: Accept
          required: false
          description: |
            Optional. Specify `application/ld+json` to receive only the JSON-LD content without wrapper metadata. Defaults to `application/json` which includes metadata fields (status, etag, hash, etc.).
          schema:
            type: string
            enum:
              - application/json
              - application/ld+json
          example: "application/json"
      responses:
        '200':
          $ref: '#/components/responses/OkJsonLd'
        '304':
          $ref: '#/components/responses/NotModified'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        **Required.** Standard HTTP Bearer token authentication. Include your API key in the `Authorization` header as `Bearer YOUR_API_KEY`.

  headers:
    RateLimit-Limit:
      description: Maximum requests in current window.
      schema:
        type: integer
        minimum: 0
    RateLimit-Remaining:
      description: Remaining requests in current window.
      schema:
        type: integer
        minimum: 0
    RateLimit-Reset:
      description: UNIX timestamp when rate limit resets.
      schema:
        type: integer
        minimum: 0
    Location:
      description: URL of the newly created resource.
      schema:
        type: string
        format: uri
    ETag:
      description: Entity tag for conditional requests.
      schema:
        type: string

  schemas:
    JsonLdRequest:
      type: object
      description: Payload for JSON-LD generation.
      additionalProperties: false
      required: [url]
      properties:
        url:
          type: string
          format: uri
          description: |
            The target page URL to generate JSON-LD for.
            Example: `https://example.com/blog/automatic-jsonld-with-enhancely`.

    JsonLdListItem:
      type: object
      description: |
        A summary record of a JSON-LD document (without the actual JSON-LD content).
      required:
        - hash
        - url
        - etag
        - crawled_at
        - status
      properties:
        hash:
          type: string
          description: MD5 hash of the URL
        url:
          type: string
          description: The source URL
        etag:
          type: string
          nullable: true
          description: ETag for caching (null when not yet crawled)
        crawled_at:
          type: string
          format: date-time
          nullable: true
          description: When the URL was last crawled (null when not yet crawled)
        status:
          $ref: '#/components/schemas/JsonLdStatus'
      example:
        hash: "7c165c13f93d7ca168bcfbd73cf563e3"
        url: "https://example.com/lecture-12"
        etag: "a1b2c3d4e5f6"
        crawled_at: "2025-01-16T14:30:00Z"
        status: "ready"

    JsonLdDocument:
      type: object
      description: |
        A JSON-LD document (Schema.org format). May include any fields.
      additionalProperties: true
      example:
        "@context": "https://schema.org"
        "@graph":
          - "@type": "WebPage"
            "@id": "https://example.com/lecture-12"
            name: "Lecture 12: Graphs, networks, incidence matrices"
            description: "These video lectures of Professor Gilbert Strang teaching 18.06 were recorded in Fall 1999 and do not correspond precisely to the current edition of the textbook."
            publisher:
              "@type": "CollegeOrUniversity"
              name: "MIT OpenCourseWare"
            license: "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
        status: "ready"
        etag: "a1b2c3d4e5f6"
        hash: "7c165c13f93d7ca168bcfbd73cf563e3"
        url: "https://example.com/lecture-12"
        crawledAt: "2025-01-16T14:30:00Z"
        createdAt: "2025-01-15T09:45:00Z"
        updatedAt: "2025-01-16T14:30:00Z"

    JsonLdStatus:
      type: string
      description: |
        Processing status of a JSON-LD record.
        - `created`: Initial status when record is created but processing hasn't started
        - `updating`: Document is actively being processed by the AI crawler
        - `failed`: JSON-LD generation failed (no valid JSON-LD could be generated)
        - `ready`: Successfully generated JSON-LD document (has etag and content)
      enum:
        - created
        - updating
        - failed
        - ready

    Problem:
      type: object
      description: Standard error object in RFC 7807 style.
      required:
        - type
        - title
        - status
        - detail
      properties:
        type:
          type: string
          format: uri
          description: URI identifying the error type.
        title:
          type: string
          description: Short error summary.
        status:
          type: integer
          description: HTTP status code.
        detail:
          type: string
          description: Human-readable error details.
        instance:
          type: string
          description: Optional URI identifying this error occurrence.
        code:
          type: string
          description: Optional machine-readable error code.
      additionalProperties: true
      example:
        type: "https://enhancely.ai/problems/bad-request"
        title: "Bad Request"
        status: 400
        detail: "Invalid JSON in request body"

  requestBodies:
    JsonLdRequestBody:
      description: |
        **Required.** JSON request body with the URL to generate JSON-LD for.
        The `Content-Type` header must be `application/json`.
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JsonLdRequest'
          example:
            url: "https://example.com/blog/automatic-jsonld-with-enhancely"

  responses:
    CreatedJsonLd:
      description: |
        Record created and the crawler is now processing the requested resource.
        Returns a Problem response indicating processing has started.
        Poll this endpoint to check when processing completes.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/created-and-processing"
            title: "Created and Processing"
            status: 201
            detail: "Record created and the crawler is now processing the requested resource. Please try again later."

    AcceptedJsonLd:
      description: |
        The crawler is still processing the requested resource.
        Returns a Problem response indicating processing is ongoing.
        Poll this endpoint to check when processing completes.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/still-processing"
            title: "Still Processing"
            status: 202
            detail: "The crawler is still processing the requested resource. Please try again later."

    NotModified:
      description: Not modified (ETag matched; no body returned).
      headers:
        ETag:
          description: Entity tag for conditional requests.
          schema: { type: string }

    NotFound:
      description: Not found.
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Problem' }
          example:
            type: "https://enhancely.ai/problems/not-found"
            title: "Not Found"
            status: 404
            detail: "The requested JSON-LD resource was not found"

    OkJsonLdList:
      description: List of JSON-LD records returned successfully.
      headers:
        X-Count:
          description: Total number of records returned
          schema:
            type: integer
        RateLimit-Limit:
          $ref: '#/components/headers/RateLimit-Limit'
        RateLimit-Remaining:
          $ref: '#/components/headers/RateLimit-Remaining'
        RateLimit-Reset:
          $ref: '#/components/headers/RateLimit-Reset'
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/JsonLdListItem'
          example:
            - hash: "7c165c13f93d7ca168bcfbd73cf563e3"
              url: "https://example.com/lecture-12"
              etag: "a1b2c3d4e5f6"
              crawled_at: "2025-01-16T14:30:00Z"
              status: "ready"
            - hash: "9d8c7b6a5e4f3d2c1b0a9e8d7c6b5a4f"
              url: "https://example.com/lecture-13"
              etag: "f6e5d4c3b2a1"
              crawled_at: "2025-01-16T15:00:00Z"
              status: "ready"
            - hash: "1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d"
              url: "https://example.com/lecture-14"
              etag: null
              crawled_at: null
              status: "created"

    OkJsonLd:
      description: JSON-LD returned; already existed or recently generated.
      headers:
        ETag:
          description: Entity tag for conditional requests.
          schema: { type: string }
        RateLimit-Limit:
          $ref: '#/components/headers/RateLimit-Limit'
        RateLimit-Remaining:
          $ref: '#/components/headers/RateLimit-Remaining'
        RateLimit-Reset:
          $ref: '#/components/headers/RateLimit-Reset'
      content:
        application/ld+json:
          description: |
            Returns only the JSON-LD content without wrapper metadata.
            Use `Accept: application/ld+json` header to request this format.
          schema:
            type: object
            additionalProperties: true
          example:
            "@context": "https://schema.org"
            "@graph":
              - "@type": "WebPage"
                "@id": "https://example.com/lecture-12"
                name: "Lecture 12: Graphs, networks, incidence matrices"
                description: "These video lectures of Professor Gilbert Strang teaching 18.06 were recorded in Fall 1999 and do not correspond precisely to the current edition of the textbook."
                publisher:
                  "@type": "CollegeOrUniversity"
                  name: "MIT OpenCourseWare"
                license: "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
        application/json:
          description: |
            Returns JSON-LD wrapped with metadata including hash, url, etag, status, and crawled_at.
            This is the default format when no Accept header is specified.
          schema:
            type: object
            required:
              - hash
              - url
              - jsonld
              - metadata
              - etag
              - crawled_at
              - status
            properties:
              hash:
                type: string
                description: MD5 hash of the URL
              url:
                type: string
                description: The source URL
              jsonld:
                type: object
                additionalProperties: true
                description: The JSON-LD structured data object
              metadata:
                type: object
                additionalProperties: true
                description: Additional metadata about the crawl
              etag:
                type: string
                description: ETag for caching
              crawled_at:
                type: string
                format: date-time
                description: When the URL was last crawled
              status:
                $ref: '#/components/schemas/JsonLdStatus'
          example:
            hash: "7c165c13f93d7ca168bcfbd73cf563e3"
            url: "https://example.com/lecture-12"
            jsonld:
              "@context": "https://schema.org"
              "@graph":
                - "@type": "WebPage"
                  "@id": "https://example.com/lecture-12"
                  name: "Lecture 12: Graphs, networks, incidence matrices"
                  description: "These video lectures of Professor Gilbert Strang teaching 18.06 were recorded in Fall 1999 and do not correspond precisely to the current edition of the textbook."
                  publisher:
                    "@type": "CollegeOrUniversity"
                    name: "MIT OpenCourseWare"
                  license: "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
            metadata: {}
            etag: "a1b2c3d4e5f6"
            crawled_at: "2025-01-16T14:30:00Z"
            status: "ready"

    BadRequest:
      description: Malformed or invalid URL in request.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/bad-request"
            title: "Bad Request"
            status: 400
            detail: "Invalid JSON in request body"

    Unauthorized:
      description: Missing or invalid bearer token.
      headers:
        WWW-Authenticate:
          description: Bearer authentication required.
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/unauthorized"
            title: "Unauthorized"
            status: 401
            detail: "Missing or invalid bearer token"

    PreconditionFailed:
      description: Precondition Failed.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/precondition-failed"
            title: "Precondition Failed"
            status: 412
            detail: "The precondition given in the request header fields evaluated to false"

    UnsupportedMediaType415:
      description: Content-Type not supported.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/unsupported-media-type"
            title: "Unsupported Media Type"
            status: 415
            detail: "Content-Type must be application/json"

    TooManyRequests:
      description: Rate limit exceeded.
      headers:
        RateLimit-Limit:
          $ref: '#/components/headers/RateLimit-Limit'
        RateLimit-Remaining:
          $ref: '#/components/headers/RateLimit-Remaining'
        RateLimit-Reset:
          $ref: '#/components/headers/RateLimit-Reset'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/rate-limit-exceeded"
            title: "Rate Limit Exceeded"
            status: 429
            detail: "You have exceeded your rate limit. Please try again later."

    ServerError:
      description: Unexpected server error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/server-error"
            title: "Internal Server Error"
            status: 500
            detail: "An unexpected server error occurred"
