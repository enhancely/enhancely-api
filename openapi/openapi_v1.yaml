openapi: 3.1.0
jsonSchemaDialect: https://spec.openapis.org/oas/3.1/dialect/base
info:
  title: Enhancely API
  version: "1.2.0"
  x-logo:
    url: enhancely-logo.png
    altText: Enhancely Logo
    backgroundColor: "#FFFFFF"
    href: https://enhancely.ai
  description: |
    ## Overview

    The Enhancely API provides automatic generation and retrieval of Schema.org JSON-LD structured data for your web pages. This structured data helps search engines, AI platforms, and AI search tools better understand and represent your content.

    ## Quick Start Guide

    ### How It Works

    <div style="text-align: center; margin: 20px 0;">
      <img src="api-workflow-sequence.svg" alt="Enhancely API Workflow Sequence Diagram" style="max-width: 100%; height: auto;" />
    </div>

    ### Get Started in 3 Steps

    **1. Get Your API Key** - Log in to the [Enhancely Dashboard](https://enhancely.ai), add your domain, verify ownership, and copy your project API key.

    **2. Make Your First Request** - POST your page URL to `/api/v1/jsonld` with your API key. First request returns 201 (queued for processing). Wait a few minutes, then request again to get 200 with your generated JSON-LD.

    **3. Integrate Into Your Website** - Add the returned JSON-LD in a `<script type="application/ld+json">` tag in your page's `<head>` section. Implement caching with ETags for production.

    ### Key Benefits

    - **Automatic Updates**: Nightly crawls detect content changes and regenerate JSON-LD
    - **Efficient Caching**: ETag-based validation minimizes bandwidth and API calls
    - **Always Fresh**: Your structured data stays synchronized with page content
    - **Minimal Maintenance**: Automatic nightly updates with manual cache clearing only when you update content


    ## Prerequisites

    This API is exclusively available to Enhancely customers who have:
    1. Added their domain to the Enhancely platform
    2. Validated domain ownership
    3. Retrieved their project API key from the Enhancely Dashboard

    ## Integration Approaches

    ### POST vs GET: Which Endpoint to Use

    **Use POST /api/v1/jsonld for CMS & Website Integration:**
    - Primary endpoint for page-level integration
    - Automatically creates records if they don't exist
    - Supports sending complex URLs in request body (no query string length limits)
    - Returns `412 Precondition Failed` when ETag matches (cache valid)
    - Ideal for server-side rendering in templates

    **Use GET /api/v1/jsonld for:**
    - Listing all JSON-LD records across your project
    - Filtering by status, URL, hash, ETag, readonly, or timestamps
    - Paginated results with cursor-based navigation

    **Use GET /api/v1/jsonld/{hash} for:**
    - Polling processing status after receiving 201/202 from POST
    - Direct retrieval when you already have the MD5 hash
    - Returns `304 Not Modified` when ETag matches (cache valid)

    ### CMS Plugins & Website Integration (Recommended)

    For integrating Enhancely into your website or CMS, follow this pattern:

    1. **Template Integration**: Add the API call in your page template's `<head>` section
    2. **URL Normalization**: Strip query parameters, hashes, and trailing slashes before caching
    3. **Cache-First Strategy**: Check local cache before making API requests (recommended TTL: 1 week)
    4. **Cache Key Generation**: Use MD5 hash of the normalized URL as the cache key
    5. **ETag Validation**: Always send `If-None-Match` header with cached ETag
    6. **Silent Degradation**: Return empty output on errors to avoid breaking page rendering
    7. **Cache Invalidation**: Clear local cache when you manually update page content via CMS (use CMS hooks like `page.update:before`). Auto-clear cache in local/development environments for testing.

    **Note**: Enhancely automatically checks all indexed URLs nightly. Normal content changes are detected via ETag validation on your next API call—manual cache clearing is only needed when you actively update content through your CMS.

    ## Cache Strategy

    Enhancely uses HTTP ETag-based caching:

    ### HTTP-Level Caching (ETags)

    Every JSON-LD response includes an `ETag` header—a unique identifier for that version of the content. Use ETags for efficient caching:

    ```http
    # First request
    POST /api/v1/jsonld
    Authorization: Bearer YOUR_API_KEY
    Content-Type: application/json
    Accept: application/json

    {"url": "https://example.com/page"}

    HTTP/1.1 200 OK
    ETag: "a1b2c3d4e5f6"
    Content-Type: application/json

    {
      "hash": "7c165c13f93d7ca168bcfbd73cf563e3",
      "url": "https://example.com/page",
      "jsonld": {...},
      "etag": "a1b2c3d4e5f6",
      "crawled_at": "2025-01-16T14:30:00Z",
      "http_status_code": 200,
      "status": "ready",
      "readonly": false
    }
    ```

    ```http
    # Subsequent request with cached ETag
    POST /api/v1/jsonld
    Authorization: Bearer YOUR_API_KEY
    Content-Type: application/json
    Accept: application/json
    If-None-Match: "a1b2c3d4e5f6"

    {"url": "https://example.com/page"}

    HTTP/1.1 412 Precondition Failed
    ```

    **Benefits:**
    - `412 Precondition Failed` responses include minimal Problem body indicating cache is valid
    - Avoids redundant processing when content hasn't changed
    - Standard HTTP caching mechanism supported by all HTTP clients
    - Learn more: [MDN: HTTP Conditional Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests)

    ### Content Change Detection

    When HTML content changes, Enhancely reprocesses the JSON-LD and generates a new ETag.

    ### Recommended Flow:
    1. Check local cache for ETag and JSON-LD data
    2. Make POST request with `If-None-Match` header containing cached ETag
    3. Handle 412 response by returning cached data (ETag still valid)
    4. Handle 200 response by caching new ETag and JSON-LD with 1-week TTL
    5. Handle errors by returning cached data or empty output (silent degradation)

    ## Processing Model

    JSON-LD generation is **asynchronous**. When you submit a URL:

    1. **201 Created**: The URL is queued for processing (first time submission)
    2. **202 Accepted**: The URL exists but is currently being processed
    3. **200 OK**: The JSON-LD already exists and is available (with current status)

    Processing typically takes 1-3 minutes depending on page complexity and queue depth. The response includes a `status` field:

    - `created`: Queued for processing, JSON-LD generation hasn't started yet (typically returns 201 on first POST)
    - `updating`: Currently being processed (returns 202 when still processing)
    - `ready`: JSON-LD is available and ready to use (returns 200 with full content)
    - `failed`: Generation failed (e.g., invalid page, unreachable URL)

    For newly created records or records being processed (201/202 responses), poll the **GET /api/v1/jsonld/{hash}** endpoint to check when processing completes and the status becomes `ready`.

    ## Rate Limiting

    All endpoints are rate-limited per organization. Each response includes rate limit headers to help you track your usage.

    ### Rate Limit Headers

    ```http
    RateLimit-Limit: 100        # Maximum requests allowed in the current window
    RateLimit-Remaining: 75     # Requests remaining in the current window
    RateLimit-Reset: 3600       # Seconds until the rate limit window resets
    ```

    ### Handling Rate Limits

    **429 Too Many Requests Response:**
    ```json
    {
      "type": "https://enhancely.ai/problems/rate-limit-exceeded",
      "title": "Rate Limit Exceeded",
      "status": 429,
      "detail": "You have exceeded your rate limit. Please try again later."
    }
    ```

    ### Best Practices for Rate Limit Management

    **1. Monitor Rate Limit Headers**

    Check `RateLimit-Remaining` and `RateLimit-Reset` headers to track usage and implement proactive backoff when limits are approaching.

    **2. Implement Retry Logic**

    For 429 responses, wait for the number of seconds indicated by the `RateLimit-Reset` header before retrying. For 5xx server errors, use exponential backoff (e.g., 1s, 2s, 4s).

    **3. Use Silent Degradation**

    When rate limited or encountering errors, return cached data or empty output rather than breaking page rendering.

    ## Error Handling

    The API uses standard HTTP status codes and RFC 7807 Problem Details format for errors.

    ### Key Status Codes

    **Success States:**
    - **200 OK** - JSON-LD ready and returned
    - **201 Created** - URL queued for first-time processing
    - **202 Accepted** - Processing in progress

    **Cache States:**
    - **304 Not Modified** (GET) / **412 Precondition Failed** (POST) - Use cached data

    **Client Errors (4xx):**
    - **400** - Invalid URL or malformed request
    - **401** - Missing/invalid API key
    - **403** - Plan limit or domain validation limit exceeded
    - **404** - Resource doesn't exist
    - **415** - Wrong Content-Type header
    - **429** - Rate limit exceeded or monthly generation limit reached

    **Server Errors (5xx):**
    - **500/502/503** - Retry with exponential backoff, use cached data

    ### Error Response Format

    ```json
    {
      "type": "https://enhancely.ai/problems/rate-limit-exceeded",
      "title": "Rate Limit Exceeded",
      "status": 429,
      "detail": "You have exceeded your rate limit. Please try again later."
    }
    ```

    ### Best Practices

    - **Silent Degradation**: Return cached data or empty output on errors—never break page rendering
    - **Cache on Success**: Only cache 200 responses with ETag
    - **Use Cache on 412/5xx/429**: Return cached data when receiving these status codes
    - **Don't Retry Client Errors**: Log and return empty for 400/401/404
    - **Monitor in Production**: Use tools like Sentry or New Relic

servers:
  - url: https://app.enhancely.ai
    description: API V1
tags:
  - name: JSON-LD Endpoints
    description: |
      Endpoints for generating and retrieving Schema.org JSON-LD structured data from web page URLs.

      These endpoints enable automatic creation of rich structured data that helps search engines, AI platforms, and AI search tools better understand and represent your content.
x-tagGroups:
  - name: Enhancely API
    tags:
      - JSON-LD Endpoints

paths:
  /api/v1/jsonld:
    get:
      tags: [ JSON-LD Endpoints ]
      summary: List JSON-LD records for all domains in your project
      description: |
        Returns a paginated list of JSON-LD records across all domains in the authenticated project.

        **Key Features:**
        - Cursor-based pagination with configurable page size
        - Filterable by hash, URL, status, ETag, readonly, and timestamps
        - Efficient project-level index lookup

      operationId: listJsonLd
      security:
        - BearerAuth: [ ]
      parameters:
        - in: query
          name: limit
          required: false
          description: |
            Maximum number of records per page. Default: 100, Max: 1000.
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 100
        - in: query
          name: next_token
          required: false
          description: |
            Pagination cursor from a previous response. Pass this to retrieve the next page of results.
          schema:
            type: string
        - in: query
          name: hash
          required: false
          description: Filter by exact hash (MD5 of normalized URL).
          schema:
            type: string
        - in: query
          name: url
          required: false
          description: |
            Filter by URL. The hostname is used to narrow to the matching domain, then exact URL match is applied.
          schema:
            type: string
        - in: query
          name: status
          required: false
          description: Filter by processing status.
          schema:
            $ref: '#/components/schemas/JsonLdStatus'
        - in: query
          name: etag
          required: false
          description: |
            Filter by ETag value. Use `*` to match records that have any ETag (i.e., have been processed at least once).
          schema:
            type: string
        - in: query
          name: readonly
          required: false
          description: Filter by readonly status.
          schema:
            type: boolean
        - in: query
          name: created_at
          required: false
          description: Filter records created after this timestamp (ISO 8601).
          schema:
            type: string
            format: date-time
        - in: query
          name: updated_at
          required: false
          description: Filter records updated after this timestamp (ISO 8601).
          schema:
            type: string
            format: date-time
        - in: query
          name: crawled_at
          required: false
          description: Filter records crawled after this timestamp (ISO 8601).
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Paginated list of JSON-LD records.
          headers:
            RateLimit-Limit:
              $ref: '#/components/headers/RateLimit-Limit'
            RateLimit-Remaining:
              $ref: '#/components/headers/RateLimit-Remaining'
            RateLimit-Reset:
              $ref: '#/components/headers/RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - data
                  - pagination
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/JsonLdListItem'
                  pagination:
                    type: object
                    required:
                      - count
                      - limit
                    properties:
                      count:
                        type: integer
                        description: Number of records in this page.
                      limit:
                        type: integer
                        description: Requested page size.
                      next_token:
                        type: string
                        description: Cursor for the next page. Absent when there are no more results.
              example:
                data:
                  - hash: "7c165c13f93d7ca168bcfbd73cf563e3"
                    url: "https://example.com/page"
                    etag: "a1b2c3d4e5f6"
                    crawled_at: "2025-01-16T14:30:00Z"
                    http_status_code: 200
                    status: "ready"
                    readonly: false
                  - hash: "e4d909c290d0fb1ca068ffaddf22cbd0"
                    url: "https://example.com/about"
                    etag: "b2c3d4e5f6a7"
                    crawled_at: "2025-01-16T15:00:00Z"
                    http_status_code: 200
                    status: "ready"
                    readonly: false
                pagination:
                  count: 2
                  limit: 100
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      tags: [ JSON-LD Endpoints ]
      summary: Generate or retrieve JSON-LD for a URL (Primary Integration Endpoint)
      description: |
        **Recommended endpoint for CMS plugins and website integrations.**

        Submits a URL for JSON-LD generation or retrieves existing data if already processed. Automatically creates new records if they don't exist.

        **Response Codes:**
        - **200 OK** - JSON-LD exists (check `status`: `ready`, `updating`, or `failed`)
        - **201 Created** - URL queued for first-time processing (poll GET /{hash} for completion)
        - **202 Accepted** - Currently being processed (poll GET /{hash} for completion)
        - **403 Forbidden** - Plan limit exceeded or domain not validated
        - **412 Precondition Failed** - ETag matches, use cached data
        - **429 Too Many Requests** - Monthly generation limit reached (includes `Retry-After` header)

        **Key Features:**
        - Asynchronous processing (typically a few minutes for new URLs)
        - ETag-based conditional requests for efficient caching
        - Supports complex URLs in request body (no query string limits)
        - Optionally accepts `html` in the request body to skip crawling



      operationId: postJsonLd
      security:
        - BearerAuth: [ ]
      parameters:
        - in: header
          name: If-None-Match
          required: false
          description: |
            Optional. The ETag value from a previous response. If provided and matches the current ETag, returns `412 Precondition Failed`.
          schema:
            type: string
          example: "a1b2c3d4e5f6"
        - in: header
          name: Accept
          required: false
          description: |
            Optional. Specify `application/ld+json` to receive only the JSON-LD content without wrapper metadata. Defaults to `application/json` which includes metadata fields (status, etag, hash, etc.).
          schema:
            type: string
            enum:
              - application/json
              - application/ld+json
          example: "application/json"
      requestBody:
        $ref: '#/components/requestBodies/JsonLdRequestBody'
      responses:
        '201':
          $ref: '#/components/responses/CreatedJsonLd'
        '202':
          $ref: '#/components/responses/AcceptedJsonLd'
        '200':
          $ref: '#/components/responses/OkJsonLd'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/LimitExceeded'
        '412':
          $ref: '#/components/responses/PreconditionFailed'
        '415':
          $ref: '#/components/responses/UnsupportedMediaType415'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/v1/jsonld/{hash}:
    get:
      tags: [ JSON-LD Endpoints ]
      summary: Retrieve a specific JSON-LD document by URL hash
      description: |
        Retrieves JSON-LD for a URL using its MD5 hash. Primarily used for polling processing status after POST returns 201/202.

        **Primary use cases:**
        - Polling processing status after POST returns 201/202
        - Direct retrieval when you have the MD5 hash
        - ETag-based caching (returns 304 when content unchanged)

        **Special Headers:**
        - Send `Cache-Control: no-cache` to bypass the server-side Redis cache and force a fresh database lookup (useful for debugging).

        **URL Hash Calculation:**

        The `hash` parameter is the MD5 hash of the absolute URL (lowercase hexadecimal):

        ```javascript
        import crypto from 'crypto';
        const hash = crypto.createHash('md5').update('https://example.com/page').digest('hex');
        // Result: "7c165c13f93d7ca168bcfbd73cf563e3"
        ```

        **Response Codes:**
        - **200 OK** - JSON-LD returned with metadata (includes `status` field)
        - **304 Not Modified** - Content unchanged (when `If-None-Match` header matches ETag)
        - **404 Not Found** - Hash doesn't exist (use POST to create)

      operationId: getJsonLdById
      security:
        - BearerAuth: [ ]
      parameters:
        - in: path
          name: hash
          required: true
          description: |
            MD5 of the absolute URL (32 lowercase hexadecimal characters).
            Example: `7c165c13f93d7ca168bcfbd73cf563e3`.
          schema:
            type: string
            pattern: '^[a-f0-9]{32}$'
        - in: header
          name: If-None-Match
          required: false
          description: |
            Optional. Return `304 Not Modified` if the supplied ETag matches the current resource ETag.
          schema:
            type: string
          example: "a1b2c3d4e5f6"
        - in: header
          name: Cache-Control
          required: false
          description: |
            Optional. Send `no-cache` to bypass the server-side Redis cache and force a fresh database lookup. Useful for debugging or verifying that regeneration has completed.
          schema:
            type: string
          example: "no-cache"
        - in: header
          name: Accept
          required: false
          description: |
            Optional. Specify `application/ld+json` to receive only the JSON-LD content without wrapper metadata. Defaults to `application/json` which includes metadata fields (status, etag, hash, etc.).
          schema:
            type: string
            enum:
              - application/json
              - application/ld+json
          example: "application/json"
      responses:
        '200':
          $ref: '#/components/responses/OkJsonLd'
        '304':
          $ref: '#/components/responses/NotModified'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/ServerError'
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        **Required.** Standard HTTP Bearer token authentication. Include your project API key in the `Authorization` header as `Bearer YOUR_API_KEY`. Project API keys use the format `sk-...`.

  headers:
    RateLimit-Limit:
      description: Maximum requests in current window.
      schema:
        type: integer
        minimum: 0
    RateLimit-Remaining:
      description: Remaining requests in current window.
      schema:
        type: integer
        minimum: 0
    RateLimit-Reset:
      description: Seconds remaining until the rate limit window resets.
      schema:
        type: integer
        minimum: 0
  schemas:
    JsonLdRequest:
      type: object
      description: Payload for JSON-LD generation.
      additionalProperties: false
      required: [url]
      properties:
        url:
          type: string
          format: uri
          description: |
            The target page URL to generate JSON-LD for.
            Example: `https://example.com/blog/automatic-jsonld-with-enhancely`.
        html:
          type: string
          description: |
            Optional. Raw HTML content of the page. When provided, the crawler will use this HTML instead of fetching the page, allowing you to generate JSON-LD for pages that require JavaScript rendering or are behind authentication.

            **Limits:** Max 5 MB uncompressed.

    JsonLdListItem:
      type: object
      description: Summary of a JSON-LD record returned in list responses.
      required:
        - hash
        - url
        - status
      properties:
        hash:
          type: string
          description: MD5 hash of the normalized URL.
        url:
          type: string
          description: The source URL.
        etag:
          type: ['string', 'null']
          description: ETag for caching. Null if the record hasn't been processed yet.
        crawled_at:
          type: ['string', 'null']
          format: date-time
          description: When the URL was last crawled.
        http_status_code:
          type: ['integer', 'null']
          description: HTTP status code returned when the page was crawled.
        status:
          $ref: '#/components/schemas/JsonLdStatus'
        readonly:
          type: ['boolean', 'null']
          description: Whether this record is read-only (protected from regeneration).

    JsonLdStatus:
      type: string
      description: |
        Processing status of a JSON-LD record.
        - `created`: Initial status when record is created but processing hasn't started
        - `updating`: Document is actively being processed by the AI crawler
        - `failed`: JSON-LD generation failed (e.g., invalid page, unreachable URL)
        - `ready`: Successfully generated JSON-LD document (has etag and content)
        - `ignored`: Record has been marked as ignored and will not be regenerated
        - `generation_limit_reached`: Monthly generation limit was reached during processing
      enum:
        - created
        - updating
        - failed
        - ready
        - ignored
        - generation_limit_reached

    Problem:
      type: object
      description: Standard error object in RFC 7807 style.
      required:
        - type
        - title
        - status
        - detail
      properties:
        type:
          type: string
          format: uri
          description: URI identifying the error type.
        title:
          type: string
          description: Short error summary.
        status:
          type: integer
          description: HTTP status code.
        detail:
          type: string
          description: Human-readable error details.
        instance:
          type: string
          description: Optional URI identifying this error occurrence.
        code:
          type: string
          description: Optional machine-readable error code.
      additionalProperties: true
      example:
        type: "https://enhancely.ai/problems/bad-request"
        title: "Bad Request"
        status: 400
        detail: "Invalid JSON in request body"

  requestBodies:
    JsonLdRequestBody:
      description: |
        **Required.** JSON request body with the URL to generate JSON-LD for.
        The `Content-Type` header must be `application/json`.
        Optionally include `html` to provide page content directly (skip crawling).
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JsonLdRequest'
          examples:
            url-only:
              summary: Standard request (URL only)
              value:
                url: "https://example.com/blog/automatic-jsonld-with-enhancely"
            with-html:
              summary: With custom HTML (skip crawling)
              value:
                url: "https://example.com/blog/automatic-jsonld-with-enhancely"
                html: "<html><head><title>My Page</title></head><body><h1>Content</h1></body></html>"

  responses:
    CreatedJsonLd:
      description: |
        Record created and the crawler is now processing the requested resource. Poll the `GET /api/v1/jsonld/{hash}` endpoint to check when processing completes.
      content:
        application/json:
          schema:
            type: object
            properties:
              status:
                type: string
                description: Processing status indicator.
              message:
                type: string
                description: Human-readable status message.
          example:
            status: "processing"
            message: "Record created and the crawler is now processing the requested resource. Please try again later."

    AcceptedJsonLd:
      description: |
        The crawler is still processing the requested resource.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/still-processing"
            title: "Still Processing"
            status: 202
            detail: "The crawler is still processing the requested resource. Please try again later."

    NotModified:
      description: Not modified (ETag matched; no body returned).
      headers:
        ETag:
          description: Entity tag for conditional requests.
          schema: { type: string }

    NotFound:
      description: Not found.
      content:
        application/json:
          schema: { $ref: '#/components/schemas/Problem' }
          example:
            type: "https://enhancely.ai/problems/not-found"
            title: "Not Found"
            status: 404
            detail: "The requested JSON-LD resource was not found"

    OkJsonLd:
      description: JSON-LD returned; already existed or recently generated.
      headers:
        ETag:
          description: Entity tag for conditional requests.
          schema: { type: string }
        X-Redis-Cache:
          description: Whether the response was served from Redis cache (`HIT`) or the database (`MISS`).
          schema:
            type: string
            enum: [HIT, MISS]
        X-JsonLd-Status:
          description: Present only when the record status is `ignored`. Value is `ignored`.
          schema:
            type: string
        RateLimit-Limit:
          $ref: '#/components/headers/RateLimit-Limit'
        RateLimit-Remaining:
          $ref: '#/components/headers/RateLimit-Remaining'
        RateLimit-Reset:
          $ref: '#/components/headers/RateLimit-Reset'
      content:
        application/ld+json:
          schema:
            type: object
            additionalProperties: true
          example:
            "@context": "https://schema.org"
            "@graph":
              - "@type": "WebPage"
                "@id": "https://example.com/lecture-12"
                name: "Lecture 12: Graphs, networks, incidence matrices"
                description: "These video lectures of Professor Gilbert Strang teaching 18.06 were recorded in Fall 1999 and do not correspond precisely to the current edition of the textbook."
                publisher:
                  "@type": "CollegeOrUniversity"
                  name: "MIT OpenCourseWare"
                license: "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
        application/json:
          schema:
            type: object
            required:
              - hash
              - url
              - jsonld
              - etag
              - crawled_at
              - status
            properties:
              hash:
                type: string
                description: MD5 hash of the URL
              url:
                type: string
                description: The source URL
              jsonld:
                type: object
                additionalProperties: true
                description: The JSON-LD structured data object
              etag:
                type: string
                description: ETag for caching
              crawled_at:
                type: ['string', 'null']
                format: date-time
                description: When the URL was last crawled (null for newly created records)
              http_status_code:
                type: ['integer', 'null']
                description: HTTP status code returned when the page was crawled (e.g., 200, 404)
              status:
                $ref: '#/components/schemas/JsonLdStatus'
              readonly:
                type: ['boolean', 'null']
                description: Whether this record is read-only (protected from regeneration)
          example:
            hash: "7c165c13f93d7ca168bcfbd73cf563e3"
            url: "https://example.com/lecture-12"
            jsonld:
              "@context": "https://schema.org"
              "@graph":
                - "@type": "WebPage"
                  "@id": "https://example.com/lecture-12"
                  name: "Lecture 12: Graphs, networks, incidence matrices"
                  description: "These video lectures of Professor Gilbert Strang teaching 18.06 were recorded in Fall 1999 and do not correspond precisely to the current edition of the textbook."
                  publisher:
                    "@type": "CollegeOrUniversity"
                    name: "MIT OpenCourseWare"
                  license: "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
            etag: "a1b2c3d4e5f6"
            crawled_at: "2025-01-16T14:30:00Z"
            http_status_code: 200
            status: "ready"
            readonly: false

    BadRequest:
      description: Malformed or invalid URL in request.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/bad-request"
            title: "Bad Request"
            status: 400
            detail: "Invalid JSON in request body"

    Unauthorized:
      description: Missing or invalid bearer token.
      headers:
        WWW-Authenticate:
          description: Bearer authentication required.
          schema:
            type: string
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/unauthorized"
            title: "Unauthorized"
            status: 401
            detail: "Missing or invalid bearer token"

    PreconditionFailed:
      description: Precondition Failed.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/precondition-failed"
            title: "Precondition Failed"
            status: 412
            detail: "The precondition given in the request header fields evaluated to false"

    UnsupportedMediaType415:
      description: Content-Type not supported.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/unsupported-media-type"
            title: "Unsupported Media Type"
            status: 415
            detail: "Content-Type must be application/json"

    TooManyRequests:
      description: Rate limit or monthly generation limit exceeded.
      headers:
        RateLimit-Limit:
          $ref: '#/components/headers/RateLimit-Limit'
        RateLimit-Remaining:
          $ref: '#/components/headers/RateLimit-Remaining'
        RateLimit-Reset:
          $ref: '#/components/headers/RateLimit-Reset'
        Retry-After:
          description: Seconds until the monthly generation limit resets (only present for monthly limits).
          schema:
            type: integer
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          examples:
            rate-limit:
              summary: API rate limit exceeded
              value:
                type: "https://enhancely.ai/problems/rate-limit-exceeded"
                title: "Rate Limit Exceeded"
                status: 429
                detail: "You have exceeded your rate limit. Please try again later."
            monthly-limit:
              summary: Monthly generation limit reached
              value:
                type: "https://enhancely.ai/problems/monthly-limit-reached"
                title: "Monthly Limit Reached"
                status: 429
                detail: "Monthly generation limit of 1000 reached. Resets 2026-03-01T00:00:00.000Z."
                limit: 1000
                count: 1000
                remaining: 0
                resetAt: "2026-03-01T00:00:00.000Z"

    LimitExceeded:
      description: Plan limit exceeded or domain not validated.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          examples:
            plan-limit:
              summary: Plan JSON-LD limit reached
              value:
                type: "https://enhancely.ai/problems/plan-limit-reached"
                title: "Plan Limit Reached"
                status: 403
                detail: "You have reached your plan's JSON-LD limit of 500. Upgrade your plan to create more entries."
            domain-validation:
              summary: Domain not validated
              value:
                type: "https://enhancely.ai/problems/domain-validation-required"
                title: "Domain Validation Required"
                status: 403
                detail: "This domain is not validated yet. You can create up to 5 JSON-LDs until validation succeeds."

    ServerError:
      description: Unexpected server error.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Problem'
          example:
            type: "https://enhancely.ai/problems/server-error"
            title: "Internal Server Error"
            status: 500
            detail: "An unexpected server error occurred"
